# =============================================================================
# TMUX CONFIGURATION - TypeScript/Ruby Polyglot Developer
# =============================================================================
# Optimized for git worktree workflow and multi-language development
# Extracts the best parts from backup config with direct colors (no variables)

# =============================================================================
# CORE SETTINGS
# =============================================================================

# Better terminal support
set -g default-terminal "tmux-256color"
set -g terminal-overrides ",xterm-256color:RGB"

# Advertise terminal features and enable key/OSC passthrough
# - RGB truecolor and extended keys for both xterm and tmux-256color
# - focus-events for applications wanting focus in/out
# - allow-passthrough to forward unknown OSCs (used by Cursor/VS Code etc.)
# - extended-keys to propagate modified key sequences (Shift/Alt/Ctrl variants)
# - osc8 for hyperlink support (crucial for URL detection)
set -s terminal-features "xterm-256color:RGB,extkeys,osc8"
set -s terminal-features "tmux-256color:RGB,extkeys,osc8"
set -g focus-events on
set -g allow-passthrough on
set -g extended-keys on

# Mouse support - essential for productivity
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1

# Auto-renumber windows when one is closed (no gaps)
set-option -g renumber-windows on

# =============================================================================
# WINDOW MANAGEMENT - Perfect for worktree workflow
# =============================================================================

# Auto-rename windows to show current directory (essential for worktrees)
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'

# =============================================================================
# KEY BINDINGS
# =============================================================================

# Reload config
bind r source-file ~/.dotfiles/config/tmux/tmux.conf \; display "Config reloaded ðŸš€"

# Smart splits that preserve current directory (crucial for worktrees)
bind \\ split-window -h -c "#{pane_current_path}"
unbind Enter  # Remove Enter key binding to fix Shift+Enter in applications
bind | split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# Pane resizing with number keys (from your backup)
bind -r - resize-pane -D 2
bind -r = resize-pane -U 2
bind -r 0 resize-pane -R 2
bind -r 9 resize-pane -L 2

# Quick actions
bind x kill-pane
bind X kill-window
bind m resize-pane -Z  # maximize/restore pane

# Session management
bind-key S choose-tree -s  # interactive session picker

# =============================================================================
# COPY MODE (Vim-style)
# =============================================================================

set-window-option -g mode-keys vi
bind-key v copy-mode
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# =============================================================================
# VISUAL STYLING - Catppuccin Macchiato (Direct Colors)
# =============================================================================

# General colors
set -g mode-style "fg=#24273a,bg=#91d7e3"
set -g message-style "fg=#24273a,bg=#eed49f"
set -g message-command-style "fg=#91d7e3,bg=#363a4f"

# Pane borders
set -g pane-border-style "fg=#6e738d"
set -g pane-active-border-style "fg=#c6a0f6"

# =============================================================================
# STATUS BAR CONFIGURATION
# =============================================================================

# Status bar position and basic settings
set -g status on
set -g status-position top  # Top positioning - no conflict with nvim status
set -g status-justify left
set -g status-style "fg=#cad3f5,bg=#24273a"
set -g status-left-length 50
set -g status-right-length 100

# Left side: Session name with icon
set -g status-left "#[fg=#24273a,bg=#c6a0f6,bold] #S #[default] "

# Window status: Clean numbers with current directory names
set -g window-status-format "#[fg=#cad3f5] #I:#W "
set -g window-status-current-format "#[fg=#f5a97f,bold] #I:#W "
set -g window-status-separator ""

# Right side: Language detection only (time/day in SketchyBar)
set -g status-right "#(~/.dotfiles/config/tmux/scripts/language-detect.sh #{pane_current_path})"

# =============================================================================
# PANE BORDERS - Show path and git info (Perfect for worktrees)
# =============================================================================

set -g pane-border-status top
set -g pane-border-lines heavy

# Show current path + git branch (simplified from backup to avoid complex substitution)
set -g pane-border-format "#[fg=#8bd5ca]#{b:pane_current_path} #[fg=#c6a0f6]#(cd #{pane_current_path} 2>/dev/null && git branch --show-current 2>/dev/null | head -c 40)"

# =============================================================================
# DEVELOPMENT-FOCUSED FEATURES
# =============================================================================

# Better history limit for development work
set -g history-limit 10000

# Faster command sequences
set -s escape-time 0

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off  # Don't show notifications, just highlight in status

# Clock mode
setw -g clock-mode-colour "#8aadf4"
setw -g clock-mode-style 24

# =============================================================================
# WINDOW & PANE STYLING
# =============================================================================

# Window status activity/bell styling
setw -g window-status-activity-style "fg=#cad3f5,bg=#24273a,none"
setw -g window-status-bell-style "fg=#ed8796,bg=#24273a,bold"

# Copy mode highlighting
setw -g mode-style "fg=#f5bde6,bg=#5b6078"
